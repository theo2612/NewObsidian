# 6.3.1 DNS Enumeration
- Domain Naming System / DNS
	- distributed database responsible for translating user-friendly domain names into IP addresses.
	- hierarchical structure that is divided into several zones, starting with the top-level root zone.
	- Common DNS records include
		- NS Nameserver records containt hte name of the authoritative servers hosting the DNS records for a domain
		- A Also known as a host record, the "a record" contains the IPv4 address of a hostname (such as www.megacorp.com)
		- AAAA Also known as a quad A host record, the 'aaaa record' contains the IPv6 address of a hostname (such as www.megacorp.com)
		- MX Mail Exchange records contain the names of the servers responsible for handling email for the domain. A domain can contain multiple MX records.
		- PTR Pointer Records are used in reverse lookup zones and can find the records associated with an IP address.
		- CNAME Canonical Name Records are used to create aliases for other host records
		- TXT Text records can contain any arbitrary data and be used for various purposes, such as domain ownership verification. 
	- host command to find A records or IP address of website 
		- `host <domain name>`
			```bash
		┌──(kali㉿kali)-[~/offsec]
		└─$ host www.megacorpone.com
		www.megacorpone.com has address 149.56.244.87 
			```
		- by default the host command searches for an A record
		- other fields can be queried such as MX or TXT records using the -t option

	- using host to find the MX/Mail Exchange records for www.megacorpone.com
		- MX records contain names of the servers responsible for handling email for the domain
		```bash
		┌──(kali㉿kali)-[~/offsec]
		└─$ host -t mx megacorpone.com
		megacorpone.com mail is handled by 50 mail.megacorpone.com.
		megacorpone.com mail is handled by 60 mail2.megacorpone.com.
		megacorpone.com mail is handled by 10 fb.mail.gandi.net.
		megacorpone.com mail is handled by 20 spool.mail.gandi.net.
```

	- using host to find the TXT/Text records for www.megacorpone.com
		- TXT records contain arbitrary data like domain ownership verification
		```bash
		┌──(kali㉿kali)-[~/offsec]
		└─$ host -t txt megacorpone.com
		megacorpone.com descriptive text "Try Harder"
		megacorpone.com descriptive text "google-site-verification=U7B_b0HNeBtY4qYGQZNsEYXfCJ32hMNV3GtC0wWq5pA"
```

	- using host to search for a specific hostname
		- idontexist.megacorpone.com not found
		```bash
┌──(kali㉿kali)-[~/offsec]
└─$ host idontexist.megacorpone.com
Host idontexist.megacorpone.com not found: 3(NXDOMAIN)	
```

	- creating a list of possible host names
		- Bash one-liner to attempt to resolve each hostname
		- Performing forward DNS enumeration
		```Bash
┌──(kali㉿kali)-[~/offsec]
└─$ cat hostnameLists.txt 
www
ftp
mail
owa
proxy
router
                                                                        
┌──(kali㉿kali)-[~/offsec]
└─$ for ip in $(cat hostnameLists.txt); do host $ip.megacorpone.com; done 
www.megacorpone.com has address 149.56.244.87
Host ftp.megacorpone.com not found: 3(NXDOMAIN)
mail.megacorpone.com has address 167.114.21.68
Host owa.megacorpone.com not found: 3(NXDOMAIN)
Host proxy.megacorpone.com not found: 3(NXDOMAIN)
router.megacorpone.com has address 167.114.21.70
```
	- using the list of possible host names, we discover entries for "www", "mail", and "router". "ftp", "owa" and "proxy" were not found.
		- Additional wordlists can be installed with `sudo apt install selists` and can then be found at `/sur/share/seclists`
		- except for the www record. Our DNS-forward 

		- Using a Bash loop to scan IP addresses 51.222.169.200 through 51.222.169.254 and filter out invalid results, using grep -v, by showing only entries that do not contain "not found"
		```bash
┌──(kali㉿kali)-[~/offsec]
└─$ for ip in $(seq 200 254); do host 51.222.169.$ip; done | grep -v "not found"
224.169.222.51.in-addr.arpa domain name pointer apps.issl.ng.
225.169.222.51.in-addr.arpa domain name pointer worldoiltoolsng.com.
226.169.222.51.in-addr.arpa domain name pointer crvs.issl.ng.
227.169.222.51.in-addr.arpa domain name pointer landmarkservicesltd.com.
228.169.222.51.in-addr.arpa domain name pointer postoffice.issl.ng.
229.169.222.51.in-addr.arpa domain name pointer perennial.integrabanking.ng.
230.169.222.51.in-addr.arpa domain name pointer test.boardseats.io.
231.169.222.51.in-addr.arpa domain name pointer ip231.ip-51-222-169.net.
232.169.222.51.in-addr.arpa domain name pointer ip232.ip-51-222-169.net.
233.169.222.51.in-addr.arpa domain name pointer ip233.ip-51-222-169.net.
234.169.222.51.in-addr.arpa domain name pointer ip234.ip-51-222-169.net.
235.169.222.51.in-addr.arpa domain name pointer ip235.ip-51-222-169.net.
236.169.222.51.in-addr.arpa domain name pointer ip236.ip-51-222-169.net.
237.169.222.51.in-addr.arpa domain name pointer ip237.ip-51-222-169.net.
238.169.222.51.in-addr.arpa domain name pointer ip238.ip-51-222-169.net.
239.169.222.51.in-addr.arpa domain name pointer ip239.ip-51-222-169.net.
;; communications error to 24.154.1.12#53: timed out
248.169.222.51.in-addr.arpa domain name pointer mail.khronostelecom.mx.
249.169.222.51.in-addr.arpa domain name pointer ip249.ip-51-222-169.net.
250.169.222.51.in-addr.arpa domain name pointer ip250.ip-51-222-169.net.
251.169.222.51.in-addr.arpa domain name pointer ip251.ip-51-222-169.net.
252.169.222.51.in-addr.arpa domain name pointer ip252.ip-51-222-169.net.
;; communications error to 24.154.1.12#53: timed out
253.169.222.51.in-addr.arpa domain name pointer ip253.ip-51-222-169.net.
254.169.222.51.in-addr.arpa domain name pointer ip254.ip-51-222-169.net.

```

	- Automating DNS enumeration with DNSRecon and DNSenum
	- **dnsrecon** 
		- advanced DNS enumeration script written in Python
		- Below performing a successful DNS scan on  the main record types against megacorpone.com domain
			```bash
┌──(kali㉿kali)-[~]
└─$ dnsrecon -d megacorpone.com -t std
[*] std: Performing General Enumeration against: megacorpone.com...
[-] DNSSEC is not configured for megacorpone.com
[*]      SOA ns1.megacorpone.com 51.79.37.18
[*]      NS ns2.megacorpone.com 51.222.39.63
[*]      Bind Version for 51.222.39.63 "9.18.24-1-Debian"
[*]      NS ns1.megacorpone.com 51.79.37.18
[*]      Bind Version for 51.79.37.18 "9.18.24-1-Debian"
[*]      MX fb.mail.gandi.net 217.70.178.217
[*]      MX fb.mail.gandi.net 217.70.178.215
[*]      MX fb.mail.gandi.net 217.70.178.216
[*]      MX mail2.megacorpone.com 167.114.21.69
[*]      MX mail.megacorpone.com 167.114.21.68
[*]      MX spool.mail.gandi.net 217.70.178.1
[*]      MX fb.mail.gandi.net 2001:4b98:dc4:8::215
[*]      MX fb.mail.gandi.net 2001:4b98:dc4:8::217
[*]      MX fb.mail.gandi.net 2001:4b98:dc4:8::216
[*]      MX spool.mail.gandi.net 2001:4b98:e00::1
[*]      TXT megacorpone.com Try Harder
[*]      TXT megacorpone.com google-site-verification=U7B_b0HNeBtY4qYGQZNsEYXfCJ32hMNV3GtC0wWq5pA
[*] Enumerating SRV Records
[-] No SRV Records Found for megacorpone.com
```

		- below brute forcing additional hostnames using the hostnameLists.txt file we used for forward lookups
		- brute force attempt managed to resolve a few hostnames
		```bash
┌──(kali㉿kali)-[~/offsec]
└─$ cat hostnameLists.txt 
www
ftp
mail
owa
proxy
router

┌──(kali㉿kali)-[~/offsec]
└─$ dnsrecon -d megacorpone.com -D hostnameLists.txt -t brt
[*] Using the dictionary file: hostnameLists.txt (provided by user)
[*] brt: Performing host and subdomain brute force against megacorpone.com...
[+]      A www.megacorpone.com 149.56.244.87
[+]      A mail.megacorpone.com 167.114.21.68
[+]      A router.megacorpone.com 167.114.21.70
[+] 3 Records Found		
```
	- **dnsrecon** command broken down
		- **`-d`**: Specifies the target domain to perform DNS enumeration on.
		- **`megacorpone.com`**: The domain name being targeted for enumeration.
		- **`-D`**: Specifies a wordlist file for brute-forcing subdomains or hostnames.
		- **`hostnameLists.txt`**: The file containing potential subdomain or hostname names (e.g., `www`, `ftp`, `mail`, etc.).
		- - **`-t`**: Specifies the type of DNS enumeration to perform.
		- **`brt`**: Stands for **brute force**, which means dnsrecon will attempt to discover subdomains or hostnames by appending each entry in `hostnameLists.txt` to the domain and resolving it.

	- **DNSEnum** 
		- another popular DNS enumeration tool for automating 
		- below scan is just passed the domain 
			- discovery of previously unknown hosts
			```bash
┌──(kali㉿kali)-[~/offsec]                                                                                                    11:30:01 [80/135]
└─$ dnsenum megacorpone.com                                                                                                                    
dnsenum VERSION:1.3.1                                                                                                                          
                                                                                                                                               
-----   megacorpone.com   -----                                                                                                                
                                                                                                                                                                                  
Host's addresses:                                                                                                                              
__________________                                                                                                                             
                                                                                                                                                                                       
Name Servers:                                                                                                                                  
______________                                                                                                                                      
ns3.megacorpone.com.                     300      IN    A        66.70.207.180                                                                 
ns2.megacorpone.com.                     300      IN    A        51.222.39.63                                                                  
ns1.megacorpone.com.                     300      IN    A        51.79.37.18                                                                   
                                                                                                                                               
Mail (MX) Servers:                                                                                                                             
___________________                                                                                                                            
mail2.megacorpone.com.                   300      IN    A        167.114.21.69
mail.megacorpone.com.                    300      IN    A        167.114.21.68
fb.mail.gandi.net.                       60       IN    A        217.70.178.216
fb.mail.gandi.net.                       60       IN    A        217.70.178.217
fb.mail.gandi.net.                       60       IN    A        217.70.178.215
spool.mail.gandi.net.                    600      IN    A        217.70.178.1

Trying Zone Transfers and getting Bind Versions:                                                                                               
_________________________________________________                                                                                              
                                                                                                                                                  
Trying Zone Transfer for megacorpone.com on ns3.megacorpone.com ...                                                                            
AXFR record query failed: REFUSED

Trying Zone Transfer for megacorpone.com on ns2.megacorpone.com ... 
megacorpone.com.                         300      IN    SOA               (
megacorpone.com.                         300      IN    TXT            "Try
megacorpone.com.                         300      IN    TXT               (
megacorpone.com.                         300      IN    MX               10
megacorpone.com.                         300      IN    MX               20
megacorpone.com.                         300      IN    MX               50
megacorpone.com.                         300      IN    MX               60
megacorpone.com.                         300      IN    NS       ns1.megacorpone.com.
megacorpone.com.                         300      IN    NS       ns2.megacorpone.com.
megacorpone.com.                         300      IN    NS       ns3.megacorpone.com.
admin.megacorpone.com.                   300      IN    A        167.114.21.64
beta.megacorpone.com.                    300      IN    A        167.114.21.65
fs1.megacorpone.com.                     300      IN    A        167.114.21.66
intranet.megacorpone.com.                300      IN    A        167.114.21.67
mail.megacorpone.com.                    300      IN    A        167.114.21.68
mail2.megacorpone.com.                   300      IN    A        167.114.21.69
ns1.megacorpone.com.                     300      IN    A        51.79.37.18
ns2.megacorpone.com.                     300      IN    A        51.222.39.63
ns3.megacorpone.com.                     300      IN    A        66.70.207.180
router.megacorpone.com.                  300      IN    A        167.114.21.70
siem.megacorpone.com.                    300      IN    A        167.114.21.71
snmp.megacorpone.com.                    300      IN    A        167.114.21.72
support.megacorpone.com.                 300      IN    A        167.114.21.74
syslog.megacorpone.com.                  300      IN    A        167.114.21.73
test.megacorpone.com.                    300      IN    A        167.114.21.75      
vpn.megacorpone.com.                     300      IN    A        167.114.21.76      
vpn2.megacorpone.com.                    300      IN    A        167.114.21.77      
vpndev.megacorpone.com.                  300      IN    A        167.114.21.78      
vpnprod.megacorpone.com.                 300      IN    A        167.114.21.79      
www.megacorpone.com.                     300      IN    A        149.56.244.87      
www2.megacorpone.com.                    300      IN    A        149.56.244.87      
                                                             
Trying Zone Transfer for megacorpone.com on ns1.megacorpone.com ...                 
AXFR record query failed: REFUSED

Brute forcing with /usr/share/dnsenum/dns.txt:                                      
_______________________________________________                                                                                              
megacorpone.com class C netranges:
___________________________________                                                 
 51.79.37.0/24
 51.222.39.0/24
 66.70.207.0/24
 149.56.244.0/24
 167.114.21.0/24

Performing reverse lookup on 1280 ip addresses:                                     
________________________________________________                                    

0 results out of 1280 IP addresses.                                                 

megacorpone.com ip blocks:
___________________________

done.







```




























